{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport axios from \"axios\";\nimport { CLEAR_CART_REQUEST } from \"../../reducers/cart\";\nexport var onClickPayment = function onClickPayment(_ref) {\n  var type = _ref.type,\n      id = _ref.id,\n      product = _ref.product,\n      isLoggedIn = _ref.isLoggedIn,\n      session = _ref.session,\n      onChangeToggleModal = _ref.onChangeToggleModal,\n      discount = _ref.discount,\n      dispatch = _ref.dispatch,\n      quantity = _ref.quantity,\n      cart = _ref.cart,\n      ShopName = _ref.ShopName,\n      router = _ref.router,\n      ShopId = _ref.ShopId,\n      TableId = _ref.TableId;\n\n  var onWindowScroll = function onWindowScroll() {\n    window.scrollTo({\n      top: 0\n    });\n  };\n\n  console.log(cart);\n  var originData;\n  var amount = 0;\n  var name;\n\n  if (isLoggedIn) {\n    if (type == \"single\") {\n      originData = {\n        id: id,\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: ShopId,\n        price: product.price * (1 - discount) * quantity,\n        quantity: quantity,\n        ShopName: ShopName,\n        ProductTitle: product.title\n      };\n    } else {\n      cart.map(function (product) {\n        return amount += product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.discount ? product.price * (1 - product.discount) * product.quantity : product.price * product.quantity;\n      });\n      name = cart.length > 1 ? \"\".concat(product.title, \" \\uC678 \").concat(cart.length - 1, \" \\uAC74\") : product.title;\n      originData = cart.map(function (product) {\n        console.log(product.Shop);\n        return {\n          id: id,\n          ProductId: product.id,\n          ShopId: ShopId,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.discount ? product.price * (1 - product.discount) * product.quantity : product.price * product.quantity,\n          quantity: quantity,\n          ShopName: product.ShopName,\n          ProductTitle: product.title\n        };\n      });\n    }\n\n    var custom_data = JSON.stringify(type == \"single\" ? [originData] : originData);\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      var today = Date.now();\n      IMP.request_pay({\n        pay_method: \"card\",\n        name: type !== \"cart\" ? product.title : name,\n        Merchant_uid: \"uid\" + today,\n        amount: type !== \"cart\" ? product.Discount ? Math.ceil(product.price * (100 - product.Discount.rate) * 0.01) * product.quantity : discount ? Math.ceil(product.price * (1 - discount)) * quantity : product.price * product.quantity : amount,\n        custom_data: custom_data\n      }, /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(response) {\n          var success, merchant_uid, error_msg, array;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  success = response.success, merchant_uid = response.merchant_uid, error_msg = response.error_msg;\n                  _context2.prev = 1;\n\n                  if (!success) {\n                    _context2.next = 15;\n                    break;\n                  }\n\n                  _context2.next = 5;\n                  return axios.post(\"\".concat(process.env.BACKEND_IP, \"/payments/complete\"), {\n                    data: response\n                  });\n\n                case 5:\n                  _context2.next = 7;\n                  return JSON.parse(custom_data);\n\n                case 7:\n                  array = _context2.sent;\n                  _context2.next = 10;\n                  return axios.post(\"\".concat(process.env.BACKEND_IP, \"/stock/cart\"), array);\n\n                case 10:\n                  array.map( /*#__PURE__*/function () {\n                    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(product) {\n                      return _regeneratorRuntime.wrap(function _callee$(_context) {\n                        while (1) {\n                          switch (_context.prev = _context.next) {\n                            case 0:\n                              _context.next = 2;\n                              return axios.post(\"\".concat(process.env.BACKEND_IP, \"/stock/sold\"), {\n                                id: product.id,\n                                ShopId: product.ShopId,\n                                quantity: product.quantity\n                              });\n\n                            case 2:\n                            case \"end\":\n                              return _context.stop();\n                          }\n                        }\n                      }, _callee);\n                    }));\n\n                    return function (_x2) {\n                      return _ref3.apply(this, arguments);\n                    };\n                  }());\n                  dispatch({\n                    type: CLEAR_CART_REQUEST\n                  });\n\n                  if (type == \"cart\") {\n                    router.push(TableId === undefined ? \"/menu/\".concat(ShopId) : \"/menu/\".concat(ShopId, \"/\").concat(TableId));\n                  }\n\n                  _context2.next = 16;\n                  break;\n\n                case 15:\n                  alert(\"\\uACB0\\uC81C \\uC2E4\\uD328: \".concat(error_msg));\n\n                case 16:\n                  _context2.next = 21;\n                  break;\n\n                case 18:\n                  _context2.prev = 18;\n                  _context2.t0 = _context2[\"catch\"](1);\n                  return _context2.abrupt(\"return\", console.error(_context2.t0.response));\n\n                case 21:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, null, [[1, 18]]);\n        }));\n\n        return function (_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    }\n  } else {\n    onChangeToggleModal();\n  }\n};","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/Dev/project1/frontend/components/Generalui/Payment.js"],"names":["axios","CLEAR_CART_REQUEST","onClickPayment","type","id","product","isLoggedIn","session","onChangeToggleModal","discount","dispatch","quantity","cart","ShopName","router","ShopId","TableId","onWindowScroll","window","scrollTo","top","console","log","originData","amount","name","UserId","UserName","ProductId","price","ProductTitle","title","map","Discount","rate","length","Shop","custom_data","JSON","stringify","IMP","init","process","env","IAMPORT_KEY","today","Date","now","request_pay","pay_method","Merchant_uid","Math","ceil","response","success","merchant_uid","error_msg","post","BACKEND_IP","data","parse","array","push","undefined","alert","error"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { CLEAR_CART_REQUEST } from \"../../reducers/cart\";\n\nexport const onClickPayment = ({\n  type,\n  id,\n  product,\n  isLoggedIn,\n  session,\n  onChangeToggleModal,\n  discount,\n  dispatch,\n  quantity,\n  cart,\n  ShopName,\n  router,\n  ShopId,\n  TableId,\n}) => {\n  const onWindowScroll = () => {\n    window.scrollTo({ top: 0 });\n  };\n\n  console.log(cart);\n\n  let originData;\n  let amount = 0;\n  let name;\n  if (isLoggedIn) {\n    if (type == \"single\") {\n      originData = {\n        id,\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId,\n        price: product.price * (1 - discount) * quantity,\n        quantity,\n        ShopName,\n        ProductTitle: product.title,\n      };\n    } else {\n      cart.map(\n        (product) =>\n          (amount += product.Discount\n            ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity\n            : product.discount\n            ? product.price * (1 - product.discount) * product.quantity\n            : product.price * product.quantity),\n      );\n      name = cart.length > 1 ? `${product.title} 외 ${cart.length - 1} 건` : product.title;\n      originData = cart.map((product) => {\n        console.log(product.Shop);\n        return {\n          id,\n          ProductId: product.id,\n          ShopId,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount\n            ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity\n            : product.discount\n            ? product.price * (1 - product.discount) * product.quantity\n            : product.price * product.quantity,\n          quantity,\n          ShopName: product.ShopName,\n          ProductTitle: product.title,\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(type == \"single\" ? [originData] : originData);\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay(\n        {\n          pay_method: \"card\",\n          name: type !== \"cart\" ? product.title : name,\n          Merchant_uid: \"uid\" + today,\n          amount:\n            type !== \"cart\"\n              ? product.Discount\n                ? Math.ceil(product.price * (100 - product.Discount.rate) * 0.01) * product.quantity\n                : discount\n                ? Math.ceil(product.price * (1 - discount)) * quantity\n                : product.price * product.quantity\n              : amount,\n          custom_data,\n        },\n        async (response) => {\n          const { success, merchant_uid, error_msg } = response;\n          try {\n            if (success) {\n              await axios.post(`${process.env.BACKEND_IP}/payments/complete`, {\n                data: response,\n              });\n              const array = await JSON.parse(custom_data);\n              await axios.post(`${process.env.BACKEND_IP}/stock/cart`, array);\n              array.map(async (product) => {\n                await axios.post(`${process.env.BACKEND_IP}/stock/sold`, {\n                  id: product.id,\n                  ShopId: product.ShopId,\n                  quantity: product.quantity,\n                });\n              });\n              dispatch({ type: CLEAR_CART_REQUEST });\n              if (type == \"cart\") {\n                router.push(\n                  TableId === undefined ? `/menu/${ShopId}` : `/menu/${ShopId}/${TableId}`,\n                );\n              }\n            } else {\n              alert(`결제 실패: ${error_msg}`);\n            }\n          } catch (err) {\n            return console.error(err.response);\n          }\n        },\n      );\n    }\n  } else {\n    onChangeToggleModal();\n  }\n};\n"]},"metadata":{},"sourceType":"module"}