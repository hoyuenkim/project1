{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\hoyuen\\\\Documents\\\\dev\\\\project1\\\\frontend\\\\components\\\\ProductCard.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport { Card, Col, Space, Row, Divider, message, Typography, Modal, Tag } from 'antd';\nimport NumberFormat from 'react-number-format';\nimport AmountToggle from './Generalui/AmountToggle';\nimport { useDispatch } from 'react-redux';\nimport { ADD_CART_ITEM_REQUEST, CLEAR_CART_REQUEST } from '../reducers/cart';\nimport { INITIATE_QUANTITY_REQUEST } from '../reducers/menu';\nimport { useSelector } from 'react-redux';\nimport axios from 'axios';\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../reducers/payment';\nimport { useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar ProductCard = function ProductCard(_ref) {\n  _s();\n\n  var product = _ref.product;\n\n  var _useState = useState(false),\n      toggleModal = _useState[0],\n      setToggleModal = _useState[1];\n\n  var onChangeToggleModal = function onChangeToggleModal() {\n    return setToggleModal(function (prev) {\n      return !prev;\n    });\n  };\n\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.user;\n  }),\n      isLoggedIn = _useSelector.isLoggedIn,\n      session = _useSelector.session;\n\n  var onClickAddCart = function onClickAddCart() {\n    var discountedProduct = _objectSpread(_objectSpread({}, product), {}, {\n      price: product.discount ? product.price * (1 - product.discount) : product.price,\n      amount: product.discount ? product.price * (1 - product.discount) * product.quantity : product.price * product.quantity\n    });\n\n    dispatch({\n      type: ADD_CART_ITEM_REQUEST,\n      product: discountedProduct\n    });\n    dispatch({\n      type: INITIATE_QUANTITY_REQUEST,\n      data: product\n    });\n  };\n\n  var onWindowScroll = function onWindowScroll() {\n    window.scrollTo({\n      top: 0\n    });\n  };\n\n  var onClickPayment = function onClickPayment() {\n    if (isLoggedIn) {\n      dispatch({\n        type: CLEAR_CART_REQUEST\n      });\n      var originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.discount ? product.price * (100 - product.discount) * 0.01 * product.quantity : product.price * product.quantity,\n        quantity: product.quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title\n      };\n      var custom_data = JSON.stringify([originData]);\n      onWindowScroll();\n\n      if (IMP !== null) {\n        IMP.init(process.env.IAMPORT_KEY);\n        var today = Date.now();\n        IMP.request_pay({\n          pay_method: 'card',\n          name: product.title,\n          Merchant_uid: 'uid' + today,\n          amount: product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity,\n          custom_data: custom_data\n        }, callback);\n      }\n    } else {\n      onChangeToggleModal();\n    }\n  };\n\n  var callback = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n      var success, error_msg;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              success = response.success, error_msg = response.error_msg;\n\n              if (success) {\n                axios // .post(`${process.env.hostIp}/payments/complete/${product.id}/${product.Shop.id}/${session.id}`, { data: response })\n                .post(\"http://127.0.0.1:3065/payments/complete\", {\n                  data: response\n                }).then(function (response) {\n                  dispatch({\n                    type: PAYMENT_SUCCESS\n                  }, {\n                    data: response\n                  });\n                })[\"catch\"](function (e) {\n                  console.log(e);\n                  dispatch({\n                    type: PAYMENT_FAILURE\n                  }, {\n                    error: e\n                  });\n                });\n              } else {\n                alert(\"\\uACB0\\uC81C \\uC2E4\\uD328: \".concat(error_msg));\n              }\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function callback(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Modal, {\n      header: null,\n      visible: toggleModal,\n      onCancel: onChangeToggleModal,\n      footer: null,\n      children: \"\\uB85C\\uADF8\\uC778\\uC744 \\uD558\\uC154\\uC57C\\uD569\\uB2C8\\uB2E4.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(Card, {\n      title: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: product.Discount ? /*#__PURE__*/_jsxDEV(Space, {\n          children: [/*#__PURE__*/_jsxDEV(Typography.Title, {\n            level: 3,\n            children: product.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 17\n          }, _this), ' ', /*#__PURE__*/_jsxDEV(Tag, {\n            color: 'magenta',\n            children: [\"-\", product.Discount.rate, \"%\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 109,\n            columnNumber: 17\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 15\n        }, _this) : /*#__PURE__*/_jsxDEV(\"h1\", {\n          children: product.title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 15\n        }, _this)\n      }, void 0, false),\n      actions: [/*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: onClickPayment,\n        children: \"\\uC989\\uC2DC \\uAD6C\\uB9E4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 11\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: onClickAddCart,\n        children: \"\\uC7A5\\uBC14\\uAD6C\\uB2C8\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }, _this)],\n      cover: /*#__PURE__*/_jsxDEV(\"img\", {\n        style: {\n          border: \"1px solid #EFF2F5\"\n        },\n        src: product.Images[0] && \"http://127.0.0.1:3065/uploads/\".concat(product.Images[0].url)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 11\n      }, _this),\n      hoverable: true,\n      children: /*#__PURE__*/_jsxDEV(Card.Meta, {\n        description: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Row, {\n            gutter: [16, 16],\n            align: 'middle',\n            justify: 'end',\n            children: [/*#__PURE__*/_jsxDEV(Col, {\n              md: 16,\n              xs: 16,\n              style: {\n                display: 'inline-block'\n              },\n              children: [product.Discount ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                  children: \"\\uAC00\\uACA9\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 135,\n                  columnNumber: 23\n                }, _this), /*#__PURE__*/_jsxDEV(Space, {\n                  align: \"center\",\n                  children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                    style: {\n                      color: '#FF5733',\n                      fontWeight: 'bold'\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: product.price * (100 - product.Discount.rate) * 0.01,\n                      displayType: 'text',\n                      thousandSeparator: true\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 138,\n                      columnNumber: 27\n                    }, _this), \"\\uC6D0\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 137,\n                    columnNumber: 25\n                  }, _this), /*#__PURE__*/_jsxDEV(Tag, {\n                    children: [/*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: product.price,\n                      displayType: 'text',\n                      thousandSeparator: true\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 146,\n                      columnNumber: 27\n                    }, _this), \"\\uC6D0\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 145,\n                    columnNumber: 25\n                  }, _this), '  ']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 136,\n                  columnNumber: 23\n                }, _this)]\n              }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                  children: \"\\uAC00\\uACA9\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 158,\n                  columnNumber: 23\n                }, _this), /*#__PURE__*/_jsxDEV(\"h1\", {\n                  children: [/*#__PURE__*/_jsxDEV(NumberFormat, {\n                    value: product.price,\n                    displayType: 'text',\n                    thousandSeparator: true\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 160,\n                    columnNumber: 25\n                  }, _this), \"\\uC6D0\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 159,\n                  columnNumber: 23\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 157,\n                columnNumber: 21\n              }, _this), ' ']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 132,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(Col, {\n              md: 8,\n              xs: 8,\n              children: /*#__PURE__*/_jsxDEV(AmountToggle, {\n                id: product.id,\n                quantity: product.quantity\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 171,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 170,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(Row, {\n            align: 'middle',\n            justify: 'center',\n            children: [/*#__PURE__*/_jsxDEV(Col, {\n              span: 8,\n              xs: 8,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                children: \"\\uCD1D \\uC8FC\\uBB38\\uAE08\\uC561\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 177,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(Col, {\n              span: 16,\n              xs: 16,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  textAlign: 'right'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"h1\", {\n                  children: [/*#__PURE__*/_jsxDEV(NumberFormat, {\n                    value: product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity,\n                    displayType: 'text',\n                    thousandSeparator: true\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 182,\n                    columnNumber: 23\n                  }, _this), \"\\uC6D0\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 181,\n                  columnNumber: 21\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 180,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 9\n      }, _this)\n    }, product.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(ProductCard, \"SRnYD1hfmV55UkNqH2oEKG5V4UQ=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = ProductCard;\nexport default ProductCard;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProductCard\");","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/dev/project1/frontend/components/ProductCard.js"],"names":["Card","Col","Space","Row","Divider","message","Typography","Modal","Tag","NumberFormat","AmountToggle","useDispatch","ADD_CART_ITEM_REQUEST","CLEAR_CART_REQUEST","INITIATE_QUANTITY_REQUEST","useSelector","axios","PAYMENT_FAILURE","PAYMENT_SUCCESS","useState","ProductCard","product","toggleModal","setToggleModal","onChangeToggleModal","prev","dispatch","state","user","isLoggedIn","session","onClickAddCart","discountedProduct","price","discount","amount","quantity","type","data","onWindowScroll","window","scrollTo","top","onClickPayment","originData","UserId","id","UserName","name","ProductId","ShopId","Shop","ShopName","ProductTitle","title","custom_data","JSON","stringify","IMP","init","process","env","IAMPORT_KEY","today","Date","now","request_pay","pay_method","Merchant_uid","Discount","rate","callback","response","success","error_msg","post","then","e","console","log","error","alert","border","Images","url","display","color","fontWeight","textAlign"],"mappings":"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","sourcesContent":["import { Card, Col, Space, Row, Divider, message, Typography, Modal, Tag } from 'antd';\r\nimport NumberFormat from 'react-number-format';\r\nimport AmountToggle from './Generalui/AmountToggle';\r\nimport { useDispatch } from 'react-redux';\r\nimport { ADD_CART_ITEM_REQUEST, CLEAR_CART_REQUEST } from '../reducers/cart';\r\nimport { INITIATE_QUANTITY_REQUEST } from '../reducers/menu';\r\nimport { useSelector } from 'react-redux';\r\nimport axios from 'axios';\r\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../reducers/payment';\r\nimport { useState } from 'react';\r\n\r\nconst ProductCard = ({ product }) => {\r\n  const [toggleModal, setToggleModal] = useState(false);\r\n  const onChangeToggleModal = () => setToggleModal((prev) => !prev);\r\n  const dispatch = useDispatch();\r\n\r\n  const { isLoggedIn, session } = useSelector((state) => state.user);\r\n\r\n  const onClickAddCart = () => {\r\n    const discountedProduct = {\r\n      ...product,\r\n      price: product.discount ? product.price * (1 - product.discount) : product.price,\r\n      amount: product.discount\r\n        ? product.price * (1 - product.discount) * product.quantity\r\n        : product.price * product.quantity,\r\n    };\r\n    dispatch({\r\n      type: ADD_CART_ITEM_REQUEST,\r\n      product: discountedProduct,\r\n    });\r\n    dispatch({ type: INITIATE_QUANTITY_REQUEST, data: product });\r\n  };\r\n\r\n  const onWindowScroll = () => {\r\n    window.scrollTo({ top: 0 });\r\n  };\r\n\r\n  const onClickPayment = () => {\r\n    if (isLoggedIn) {\r\n      dispatch({ type: CLEAR_CART_REQUEST });\r\n\r\n      const originData = {\r\n        UserId: session.id,\r\n        UserName: session.name,\r\n        ProductId: product.id,\r\n        ShopId: product.Shop.id,\r\n        price: product.discount\r\n          ? product.price * (100 - product.discount) * 0.01 * product.quantity\r\n          : product.price * product.quantity,\r\n        quantity: product.quantity,\r\n        ShopName: product.Shop.name,\r\n        ProductTitle: product.title,\r\n      };\r\n\r\n      const custom_data = JSON.stringify([originData]);\r\n\r\n      onWindowScroll();\r\n      if (IMP !== null) {\r\n        IMP.init(process.env.IAMPORT_KEY);\r\n        const today = Date.now();\r\n        IMP.request_pay(\r\n          {\r\n            pay_method: 'card',\r\n            name: product.title,\r\n            Merchant_uid: 'uid' + today,\r\n            amount: product.Discount\r\n              ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity\r\n              : product.price * product.quantity,\r\n            custom_data,\r\n          },\r\n          callback,\r\n        );\r\n      }\r\n    } else {\r\n      onChangeToggleModal();\r\n    }\r\n  };\r\n\r\n  const callback = async (response) => {\r\n    const { success, error_msg } = response;\r\n    if (success) {\r\n      axios\r\n        // .post(`${process.env.hostIp}/payments/complete/${product.id}/${product.Shop.id}/${session.id}`, { data: response })\r\n        .post(`http://127.0.0.1:3065/payments/complete`, { data: response })\r\n        .then((response) => {\r\n          dispatch({ type: PAYMENT_SUCCESS }, { data: response });\r\n        })\r\n        .catch((e) => {\r\n          console.log(e);\r\n          dispatch({ type: PAYMENT_FAILURE }, { error: e });\r\n        });\r\n    } else {\r\n      alert(`결제 실패: ${error_msg}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Modal header={null} visible={toggleModal} onCancel={onChangeToggleModal} footer={null}>\r\n        로그인을 하셔야합니다.\r\n      </Modal>\r\n      <Card\r\n        key={product.id}\r\n        title={\r\n          <>\r\n            {product.Discount ? (\r\n              <Space>\r\n                <Typography.Title level={3}>{product.title}</Typography.Title>{' '}\r\n                <Tag color={'magenta'}>-{product.Discount.rate}%</Tag>\r\n              </Space>\r\n            ) : (\r\n              <h1>{product.title}</h1>\r\n            )}\r\n          </>\r\n        }\r\n        actions={[\r\n          <div onClick={onClickPayment}>즉시 구매</div>,\r\n          <div onClick={onClickAddCart}>장바구니</div>,\r\n        ]}\r\n        cover={\r\n          <img\r\n            style={{ border: `1px solid #EFF2F5` }}\r\n            src={product.Images[0] && `http://127.0.0.1:3065/uploads/${product.Images[0].url}`}\r\n          />\r\n        }\r\n        hoverable\r\n      >\r\n        <Card.Meta\r\n          description={\r\n            <>\r\n              <Row gutter={[16, 16]} align={'middle'} justify={'end'}>\r\n                <Col md={16} xs={16} style={{ display: 'inline-block' }}>\r\n                  {product.Discount ? (\r\n                    <>\r\n                      <h5>가격</h5>\r\n                      <Space align=\"center\">\r\n                        <h1 style={{ color: '#FF5733', fontWeight: 'bold' }}>\r\n                          <NumberFormat\r\n                            value={product.price * (100 - product.Discount.rate) * 0.01}\r\n                            displayType={'text'}\r\n                            thousandSeparator={true}\r\n                          />\r\n                          원\r\n                        </h1>\r\n                        <Tag>\r\n                          <NumberFormat\r\n                            value={product.price}\r\n                            displayType={'text'}\r\n                            thousandSeparator={true}\r\n                          />\r\n                          원\r\n                        </Tag>\r\n                        {'  '}\r\n                      </Space>\r\n                    </>\r\n                  ) : (\r\n                    <div>\r\n                      <h5>가격</h5>\r\n                      <h1>\r\n                        <NumberFormat\r\n                          value={product.price}\r\n                          displayType={'text'}\r\n                          thousandSeparator={true}\r\n                        />\r\n                        원\r\n                      </h1>\r\n                    </div>\r\n                  )}{' '}\r\n                </Col>\r\n                <Col md={8} xs={8}>\r\n                  <AmountToggle id={product.id} quantity={product.quantity} />\r\n                </Col>\r\n              </Row>\r\n              <Divider />\r\n              <Row align={'middle'} justify={'center'}>\r\n                <Col span={8} xs={8}>\r\n                  <div>총 주문금액</div>\r\n                </Col>\r\n                <Col span={16} xs={16}>\r\n                  <div style={{ textAlign: 'right' }}>\r\n                    <h1>\r\n                      <NumberFormat\r\n                        value={\r\n                          product.Discount\r\n                            ? product.price *\r\n                              (100 - product.Discount.rate) *\r\n                              0.01 *\r\n                              product.quantity\r\n                            : product.price * product.quantity\r\n                        }\r\n                        displayType={'text'}\r\n                        thousandSeparator={true}\r\n                      />\r\n                      원\r\n                    </h1>\r\n                  </div>\r\n                </Col>\r\n              </Row>\r\n            </>\r\n          }\r\n        />\r\n      </Card>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProductCard;\r\n"]},"metadata":{},"sourceType":"module"}