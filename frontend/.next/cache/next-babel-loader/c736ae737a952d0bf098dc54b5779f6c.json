{"ast":null,"code":"import axios from \"axios\";\nimport { CLEAR_CART_REQUEST } from \"../../reducers/cart\";\nexport var onClickPayment = function onClickPayment(type, product, isLoggedIn, session, onChangeToggleModal, discount, dispatch, cart, router, ShopId, TableId) {\n  var onWindowScroll = function onWindowScroll() {\n    window.scrollTo({\n      top: 0\n    });\n  };\n\n  var originData;\n  var amount = 0;\n  var name;\n\n  if (isLoggedIn) {\n    if (type == \"single\") {\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.price * (1 - discount) * quantity,\n        quantity: quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title\n      };\n    } else {\n      cart.map(function (product) {\n        return amount += product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity;\n      });\n      name = cart.length > 1 ? \"\".concat(product.title, \" \\uC678 \").concat(cart.length - 1, \" \\uAC74\") : product.title;\n      originData = cart.map(function (product) {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title\n        };\n      });\n    }\n\n    var custom_data = JSON.stringify(type == \"single\" ? [originData] : originData);\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      var today = Date.now();\n      IMP.request_pay({\n        pay_method: \"card\",\n        name: type !== \"cart\" ? product.title : name,\n        Merchant_uid: \"uid\" + today,\n        amount: type !== \"cart\" ? product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity : amount,\n        custom_data: custom_data\n      }, function (response) {\n        var success = response.success,\n            merchant_uid = response.merchant_uid,\n            error_msg = response.error_msg;\n\n        if (success) {\n          axios.post(\"\".concat(process.env.BACKEND_IP, \"/payments/complete\"), {\n            data: response\n          }).then(function (res) {\n            console.log(\"type: \".concat(type, \", ShopId: \").concat(ShopId, \", TableId: \").concat(TableId));\n            dispatch({\n              type: CLEAR_CART_REQUEST\n            });\n\n            if (type == \"cart\") {\n              router.push(TableId === undefined ? \"/menu/\".concat(ShopId) : \"/menu/\".concat(ShopId, \"/\").concat(TableId));\n            }\n          })[\"catch\"](function (err) {\n            return console.error(err);\n          });\n        } else {\n          alert(\"\\uACB0\\uC81C \\uC2E4\\uD328: \".concat(error_msg));\n        }\n      });\n    }\n  } else {\n    onChangeToggleModal();\n  }\n};","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/Dev/project1/frontend/components/Generalui/Payment.js"],"names":["axios","CLEAR_CART_REQUEST","onClickPayment","type","product","isLoggedIn","session","onChangeToggleModal","discount","dispatch","cart","router","ShopId","TableId","onWindowScroll","window","scrollTo","top","originData","amount","name","UserId","id","UserName","ProductId","Shop","price","quantity","ShopName","ProductTitle","title","map","Discount","rate","length","custom_data","JSON","stringify","IMP","init","process","env","IAMPORT_KEY","today","Date","now","request_pay","pay_method","Merchant_uid","response","success","merchant_uid","error_msg","post","BACKEND_IP","data","then","res","console","log","push","undefined","err","error","alert"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { CLEAR_CART_REQUEST } from \"../../reducers/cart\";\n\nexport const onClickPayment = (\n  type,\n  product,\n  isLoggedIn,\n  session,\n  onChangeToggleModal,\n  discount,\n  dispatch,\n  cart,\n  router,\n  ShopId,\n  TableId,\n) => {\n  const onWindowScroll = () => {\n    window.scrollTo({ top: 0 });\n  };\n\n  let originData;\n  let amount = 0;\n  let name;\n  if (isLoggedIn) {\n    if (type == \"single\") {\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.price * (1 - discount) * quantity,\n        quantity: quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title,\n      };\n    } else {\n      cart.map(\n        (product) =>\n          (amount += product.Discount\n            ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity\n            : product.price * product.quantity),\n      );\n      name = cart.length > 1 ? `${product.title} 외 ${cart.length - 1} 건` : product.title;\n      originData = cart.map((product) => {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount\n            ? product.price * (100 - product.Discount.rate) * 0.01\n            : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title,\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(type == \"single\" ? [originData] : originData);\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay(\n        {\n          pay_method: \"card\",\n          name: type !== \"cart\" ? product.title : name,\n          Merchant_uid: \"uid\" + today,\n          amount:\n            type !== \"cart\"\n              ? product.Discount\n                ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity\n                : product.price * product.quantity\n              : amount,\n          custom_data,\n        },\n        (response) => {\n          const { success, merchant_uid, error_msg } = response;\n          if (success) {\n            axios\n              .post(`${process.env.BACKEND_IP}/payments/complete`, {\n                data: response,\n              })\n              .then((res) => {\n                console.log(`type: ${type}, ShopId: ${ShopId}, TableId: ${TableId}`);\n                dispatch({ type: CLEAR_CART_REQUEST });\n                if (type == \"cart\") {\n                  router.push(\n                    TableId === undefined ? `/menu/${ShopId}` : `/menu/${ShopId}/${TableId}`,\n                  );\n                }\n              })\n              .catch((err) => {\n                return console.error(err);\n              });\n          } else {\n            alert(`결제 실패: ${error_msg}`);\n          }\n        },\n      );\n    }\n  } else {\n    onChangeToggleModal();\n  }\n};\n"]},"metadata":{},"sourceType":"module"}