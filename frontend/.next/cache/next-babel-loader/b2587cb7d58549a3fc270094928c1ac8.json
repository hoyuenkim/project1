{"ast":null,"code":"import { useDispatch, useSelector } from 'react-redux';\nimport axios from 'axios';\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../../reducers/payment';\nconst dispatch = useDispatch();\nuseEffect(() => {\n  const {\n    IMP\n  } = window;\n  setIMP(IMP);\n}, []);\nexport const onClickPayment = (type, product, setToggleModal) => {\n  const onWindowScroll = () => {\n    window.scrollTo({\n      top: 0\n    });\n  };\n\n  const {\n    cart,\n    ShopId,\n    TableId\n  } = useSelector(state => state.cart);\n  const {\n    isLoggedIn,\n    session\n  } = useSelector(state => state.user);\n  let originData;\n  let amount = 0;\n  let name;\n\n  if (isLoggedIn) {\n    if (type !== 'cart') {\n      dispatch({\n        type: CLEAR_CART_REQUEST\n      });\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.discount ? product.price * (100 - product.discount) * 0.01 * product.quantity : product.price * product.quantity,\n        quantity: product.quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title\n      };\n    } else {\n      const product = cart[0];\n      cart.map(product => amount += product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity);\n      name = cart.length > 1 ? `${product.title} 외 ${cart.length - 1} 건` : product.title;\n      originData = cart.map(product => {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(type !== 'cart' ? [originData] : originData);\n\n    if (IMP !== null) {\n      dispatch({\n        type: CLEAR_CART_REQUEST\n      });\n      IMP.init(process.env.IAMPORT_KEY);\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay({\n        pay_method: 'card',\n        name: type !== 'cart' ? product.title : name,\n        Merchant_uid: 'uid' + today,\n        amount: type !== 'cart' ? product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity : amount,\n        custom_data\n      }, callback);\n    }\n\n    const callback = async response => {\n      const {\n        success,\n        merchant_uid,\n        error_msg\n      } = response;\n\n      if (success) {\n        axios.post(`${process.env.BACKEND_IP}/payments/complete`, {\n          data: response\n        }).then(response => {\n          dispatch({\n            type: PAYMENT_SUCCESS,\n            data: response.data\n          });\n\n          if (type == 'cart') {\n            return router.push(TableId === undefined ? `/menu/${ShopId}` : `/menu/${ShopId}/${TableId}`);\n          }\n        }).catch(err => {\n          console.error(err);\n          return dispatch({\n            type: PAYMENT_FAILURE\n          });\n        });\n      } else {\n        alert(`결제 실패: ${error_msg}`);\n      }\n    };\n  } else {\n    setToggleModal();\n  }\n};","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/dev/project1/frontend/components/Generalui/Payment.js"],"names":["useDispatch","useSelector","axios","PAYMENT_FAILURE","PAYMENT_SUCCESS","dispatch","useEffect","IMP","window","setIMP","onClickPayment","type","product","setToggleModal","onWindowScroll","scrollTo","top","cart","ShopId","TableId","state","isLoggedIn","session","user","originData","amount","name","CLEAR_CART_REQUEST","UserId","id","UserName","ProductId","Shop","price","discount","quantity","ShopName","ProductTitle","title","map","Discount","rate","length","custom_data","JSON","stringify","init","process","env","IAMPORT_KEY","today","Date","now","request_pay","pay_method","Merchant_uid","callback","response","success","merchant_uid","error_msg","post","BACKEND_IP","data","then","router","push","undefined","catch","err","console","error","alert"],"mappings":"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","sourcesContent":["import { useDispatch, useSelector } from 'react-redux';\nimport axios from 'axios';\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../../reducers/payment';\n\nconst dispatch = useDispatch();\n\nuseEffect(() => {\n  const { IMP } = window;\n  setIMP(IMP);\n}, []);\n\nexport const onClickPayment = (type, product, setToggleModal) => {\n  const onWindowScroll = () => {\n    window.scrollTo({ top: 0 });\n  };\n\n  const { cart, ShopId, TableId } = useSelector((state) => state.cart);\n  const { isLoggedIn, session } = useSelector((state) => state.user);\n  let originData;\n  let amount = 0;\n\n  let name;\n  if (isLoggedIn) {\n    if (type !== 'cart') {\n      dispatch({ type: CLEAR_CART_REQUEST });\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.discount\n          ? product.price * (100 - product.discount) * 0.01 * product.quantity\n          : product.price * product.quantity,\n        quantity: product.quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title,\n      };\n    } else {\n      const product = cart[0];\n      cart.map(\n        (product) =>\n          (amount += product.Discount\n            ? product.price *\n              (100 - product.Discount.rate) *\n              0.01 *\n              product.quantity\n            : product.price * product.quantity)\n      );\n      name =\n        cart.length > 1\n          ? `${product.title} 외 ${cart.length - 1} 건`\n          : product.title;\n      originData = cart.map((product) => {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount\n            ? product.price * (100 - product.Discount.rate) * 0.01\n            : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title,\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(\n      type !== 'cart' ? [originData] : originData\n    );\n\n    if (IMP !== null) {\n      dispatch({ type: CLEAR_CART_REQUEST });\n      IMP.init(process.env.IAMPORT_KEY);\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay(\n        {\n          pay_method: 'card',\n          name: type !== 'cart' ? product.title : name,\n          Merchant_uid: 'uid' + today,\n          amount:\n            type !== 'cart'\n              ? product.Discount\n                ? product.price *\n                  (100 - product.Discount.rate) *\n                  0.01 *\n                  product.quantity\n                : product.price * product.quantity\n              : amount,\n          custom_data,\n        },\n        callback\n      );\n    }\n    const callback = async (response) => {\n      const { success, merchant_uid, error_msg } = response;\n      if (success) {\n        axios\n          .post(`${process.env.BACKEND_IP}/payments/complete`, {\n            data: response,\n          })\n          .then((response) => {\n            dispatch({ type: PAYMENT_SUCCESS, data: response.data });\n            if (type == 'cart') {\n              return router.push(\n                TableId === undefined\n                  ? `/menu/${ShopId}`\n                  : `/menu/${ShopId}/${TableId}`\n              );\n            }\n          })\n          .catch((err) => {\n            console.error(err);\n            return dispatch({ type: PAYMENT_FAILURE });\n          });\n      } else {\n        alert(`결제 실패: ${error_msg}`);\n      }\n    };\n  } else {\n    setToggleModal();\n  }\n};\n"]},"metadata":{},"sourceType":"module"}