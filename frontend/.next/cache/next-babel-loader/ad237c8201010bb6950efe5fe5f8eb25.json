{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nimport { useDispatch, useSelector } from 'react-redux';\nimport axios from 'axios';\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../../reducers/payment';\nexport var onClickPayment = function onClickPayment(type, product, setToggleModal) {\n  _s();\n\n  var dispatch = useDispatch();\n  useEffect(function () {\n    var _window = window,\n        IMP = _window.IMP;\n    setIMP(IMP);\n  }, []);\n\n  var onWindowScroll = function onWindowScroll() {\n    window.scrollTo({\n      top: 0\n    });\n  };\n\n  var _useSelector = useSelector(function (state) {\n    return state.cart;\n  }),\n      cart = _useSelector.cart,\n      ShopId = _useSelector.ShopId,\n      TableId = _useSelector.TableId;\n\n  var _useSelector2 = useSelector(function (state) {\n    return state.user;\n  }),\n      isLoggedIn = _useSelector2.isLoggedIn,\n      session = _useSelector2.session;\n\n  var originData;\n  var amount = 0;\n  var name;\n\n  if (isLoggedIn) {\n    if (type !== 'cart') {\n      dispatch({\n        type: CLEAR_CART_REQUEST\n      });\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.discount ? product.price * (100 - product.discount) * 0.01 * product.quantity : product.price * product.quantity,\n        quantity: product.quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title\n      };\n    } else {\n      var _product = cart[0];\n      cart.map(function (product) {\n        return amount += product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity;\n      });\n      name = cart.length > 1 ? \"\".concat(_product.title, \" \\uC678 \").concat(cart.length - 1, \" \\uAC74\") : _product.title;\n      originData = cart.map(function (product) {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title\n        };\n      });\n    }\n\n    var custom_data = JSON.stringify(type !== 'cart' ? [originData] : originData);\n\n    if (IMP !== null) {\n      dispatch({\n        type: CLEAR_CART_REQUEST\n      });\n      IMP.init(process.env.IAMPORT_KEY);\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      var today = Date.now();\n      IMP.request_pay({\n        pay_method: 'card',\n        name: type !== 'cart' ? product.title : name,\n        Merchant_uid: 'uid' + today,\n        amount: type !== 'cart' ? product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity : amount,\n        custom_data: custom_data\n      }, callback);\n    }\n\n    var callback = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n        var success, merchant_uid, error_msg;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                success = response.success, merchant_uid = response.merchant_uid, error_msg = response.error_msg;\n\n                if (success) {\n                  axios.post(\"\".concat(process.env.BACKEND_IP, \"/payments/complete\"), {\n                    data: response\n                  }).then(function (response) {\n                    dispatch({\n                      type: PAYMENT_SUCCESS,\n                      data: response.data\n                    });\n\n                    if (type == 'cart') {\n                      return router.push(TableId === undefined ? \"/menu/\".concat(ShopId) : \"/menu/\".concat(ShopId, \"/\").concat(TableId));\n                    }\n                  })[\"catch\"](function (err) {\n                    console.error(err);\n                    return dispatch({\n                      type: PAYMENT_FAILURE\n                    });\n                  });\n                } else {\n                  alert(\"\\uACB0\\uC81C \\uC2E4\\uD328: \".concat(error_msg));\n                }\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function callback(_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  } else {\n    setToggleModal();\n  }\n};\n\n_s(onClickPayment, \"rY/MRzpJ4h85jryRSPRXzy6i/l0=\", false, function () {\n  return [useDispatch, useSelector, useSelector];\n});","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/dev/project1/frontend/components/Generalui/Payment.js"],"names":["useDispatch","useSelector","axios","PAYMENT_FAILURE","PAYMENT_SUCCESS","onClickPayment","type","product","setToggleModal","dispatch","useEffect","window","IMP","setIMP","onWindowScroll","scrollTo","top","state","cart","ShopId","TableId","user","isLoggedIn","session","originData","amount","name","CLEAR_CART_REQUEST","UserId","id","UserName","ProductId","Shop","price","discount","quantity","ShopName","ProductTitle","title","map","Discount","rate","length","custom_data","JSON","stringify","init","process","env","IAMPORT_KEY","today","Date","now","request_pay","pay_method","Merchant_uid","callback","response","success","merchant_uid","error_msg","post","BACKEND_IP","data","then","router","push","undefined","err","console","error","alert"],"mappings":"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","sourcesContent":["import { useDispatch, useSelector } from 'react-redux';\nimport axios from 'axios';\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../../reducers/payment';\n\nexport const onClickPayment = (type, product, setToggleModal) => {\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    const { IMP } = window;\n    setIMP(IMP);\n  }, []);\n  const onWindowScroll = () => {\n    window.scrollTo({ top: 0 });\n  };\n\n  const { cart, ShopId, TableId } = useSelector((state) => state.cart);\n  const { isLoggedIn, session } = useSelector((state) => state.user);\n  let originData;\n  let amount = 0;\n\n  let name;\n  if (isLoggedIn) {\n    if (type !== 'cart') {\n      dispatch({ type: CLEAR_CART_REQUEST });\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.discount\n          ? product.price * (100 - product.discount) * 0.01 * product.quantity\n          : product.price * product.quantity,\n        quantity: product.quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title,\n      };\n    } else {\n      const product = cart[0];\n      cart.map(\n        (product) =>\n          (amount += product.Discount\n            ? product.price *\n              (100 - product.Discount.rate) *\n              0.01 *\n              product.quantity\n            : product.price * product.quantity)\n      );\n      name =\n        cart.length > 1\n          ? `${product.title} 외 ${cart.length - 1} 건`\n          : product.title;\n      originData = cart.map((product) => {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount\n            ? product.price * (100 - product.Discount.rate) * 0.01\n            : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title,\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(\n      type !== 'cart' ? [originData] : originData\n    );\n\n    if (IMP !== null) {\n      dispatch({ type: CLEAR_CART_REQUEST });\n      IMP.init(process.env.IAMPORT_KEY);\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay(\n        {\n          pay_method: 'card',\n          name: type !== 'cart' ? product.title : name,\n          Merchant_uid: 'uid' + today,\n          amount:\n            type !== 'cart'\n              ? product.Discount\n                ? product.price *\n                  (100 - product.Discount.rate) *\n                  0.01 *\n                  product.quantity\n                : product.price * product.quantity\n              : amount,\n          custom_data,\n        },\n        callback\n      );\n    }\n    const callback = async (response) => {\n      const { success, merchant_uid, error_msg } = response;\n      if (success) {\n        axios\n          .post(`${process.env.BACKEND_IP}/payments/complete`, {\n            data: response,\n          })\n          .then((response) => {\n            dispatch({ type: PAYMENT_SUCCESS, data: response.data });\n            if (type == 'cart') {\n              return router.push(\n                TableId === undefined\n                  ? `/menu/${ShopId}`\n                  : `/menu/${ShopId}/${TableId}`\n              );\n            }\n          })\n          .catch((err) => {\n            console.error(err);\n            return dispatch({ type: PAYMENT_FAILURE });\n          });\n      } else {\n        alert(`결제 실패: ${error_msg}`);\n      }\n    };\n  } else {\n    setToggleModal();\n  }\n};\n"]},"metadata":{},"sourceType":"module"}