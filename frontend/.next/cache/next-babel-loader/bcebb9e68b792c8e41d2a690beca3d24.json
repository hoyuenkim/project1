{"ast":null,"code":"import axios from \"axios\";\nimport { CLEAR_CART_REQUEST } from \"../../reducers/cart\";\nexport const onClickPayment = ({\n  type,\n  id,\n  product,\n  isLoggedIn,\n  session,\n  onChangeToggleModal,\n  discount,\n  dispatch,\n  quantity,\n  cart,\n  ShopName,\n  router,\n  ShopId,\n  TableId\n}) => {\n  const onWindowScroll = () => {\n    window.scrollTo({\n      top: 0\n    });\n  };\n\n  let originData;\n  let amount = 0;\n  let name;\n\n  if (isLoggedIn) {\n    if (type == \"single\") {\n      originData = {\n        StockId: id,\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId,\n        price: product.price * (1 - discount),\n        quantity,\n        ShopName,\n        ProductTitle: product.title\n      };\n    } else {\n      cart.map(item => amount += item.Discount ? item.price * (100 - item.Discount.rate) * 0.01 : item.discount ? item.product.price * (1 - item.discount) : item.price);\n      console.log(amount);\n      name = cart.length > 1 ? `${product.product.title} 외 ${cart.length - 1} 건` : product.product.title;\n      originData = cart.map(item => {\n        console.log(item.quantity);\n        console.log(item.product.price);\n        return {\n          StockId: item.id,\n          UserId: session.id,\n          UserName: session.name,\n          ProductId: item.product.id,\n          ShopId: item.ShopId,\n          price: item.product.price * (1 - item.discount),\n          quantity: item.quantity,\n          ShopName: item.ShopName,\n          ProductTitle: item.product.title\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(type == \"single\" ? [originData] : originData);\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay({\n        pay_method: \"card\",\n        name: type !== \"cart\" ? product.title : name,\n        Merchant_uid: \"uid\" + today,\n        amount: type !== \"cart\" ? product.Discount ? Math.ceil(product.price * (100 - product.Discount.rate) * 0.01) * product.quantity : discount ? Math.ceil(product.price * (1 - discount)) * quantity : product.price * product.quantity : amount,\n        custom_data\n      }, async response => {\n        const {\n          success,\n          merchant_uid,\n          error_msg\n        } = response;\n\n        try {\n          if (success) {\n            await axios.post(`${process.env.BACKEND_IP}/payments/complete`, {\n              data: response\n            });\n            const array = await JSON.parse(custom_data);\n            await axios.post(`${process.env.BACKEND_IP}/stock/cart`, array);\n            console.log(`stock sold id: ${id}`);\n            array.map(async product => {\n              await axios.post(`${process.env.BACKEND_IP}/stock/sold`, {\n                id,\n                ProductId: product.id,\n                ShopId: product.ShopId,\n                quantity: product.quantity\n              });\n            });\n            dispatch({\n              type: CLEAR_CART_REQUEST\n            });\n\n            if (type == \"cart\") {\n              router.push(TableId === undefined ? `/menu/${ShopId}` : `/menu/${ShopId}/${TableId}`);\n            }\n          } else {\n            alert(`결제 실패: ${error_msg}`);\n          }\n        } catch (err) {\n          return console.error(err.response);\n        }\n      });\n    }\n  } else {\n    onChangeToggleModal();\n  }\n};","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/Dev/project1/frontend/components/Generalui/Payment.js"],"names":["axios","CLEAR_CART_REQUEST","onClickPayment","type","id","product","isLoggedIn","session","onChangeToggleModal","discount","dispatch","quantity","cart","ShopName","router","ShopId","TableId","onWindowScroll","window","scrollTo","top","originData","amount","name","StockId","UserId","UserName","ProductId","price","ProductTitle","title","map","item","Discount","rate","console","log","length","custom_data","JSON","stringify","IMP","init","process","env","IAMPORT_KEY","today","Date","now","request_pay","pay_method","Merchant_uid","Math","ceil","response","success","merchant_uid","error_msg","post","BACKEND_IP","data","array","parse","push","undefined","alert","err","error"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport { CLEAR_CART_REQUEST } from \"../../reducers/cart\";\n\nexport const onClickPayment = ({\n  type,\n  id,\n  product,\n  isLoggedIn,\n  session,\n  onChangeToggleModal,\n  discount,\n  dispatch,\n  quantity,\n  cart,\n  ShopName,\n  router,\n  ShopId,\n  TableId,\n}) => {\n  const onWindowScroll = () => {\n    window.scrollTo({ top: 0 });\n  };\n\n  let originData;\n  let amount = 0;\n  let name;\n  if (isLoggedIn) {\n    if (type == \"single\") {\n      originData = {\n        StockId: id,\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId,\n        price: product.price * (1 - discount),\n        quantity,\n        ShopName,\n        ProductTitle: product.title,\n      };\n    } else {\n      cart.map(\n        (item) =>\n          (amount += item.Discount\n            ? item.price * (100 - item.Discount.rate) * 0.01\n            : item.discount\n            ? item.product.price * (1 - item.discount)\n            : item.price),\n      );\n      console.log(amount);\n      name =\n        cart.length > 1\n          ? `${product.product.title} 외 ${cart.length - 1} 건`\n          : product.product.title;\n      originData = cart.map((item) => {\n        console.log(item.quantity);\n        console.log(item.product.price);\n        return {\n          StockId: item.id,\n          UserId: session.id,\n          UserName: session.name,\n          ProductId: item.product.id,\n          ShopId: item.ShopId,\n          price: item.product.price * (1 - item.discount),\n          quantity: item.quantity,\n          ShopName: item.ShopName,\n          ProductTitle: item.product.title,\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(type == \"single\" ? [originData] : originData);\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay(\n        {\n          pay_method: \"card\",\n          name: type !== \"cart\" ? product.title : name,\n          Merchant_uid: \"uid\" + today,\n          amount:\n            type !== \"cart\"\n              ? product.Discount\n                ? Math.ceil(product.price * (100 - product.Discount.rate) * 0.01) * product.quantity\n                : discount\n                ? Math.ceil(product.price * (1 - discount)) * quantity\n                : product.price * product.quantity\n              : amount,\n          custom_data,\n        },\n        async (response) => {\n          const { success, merchant_uid, error_msg } = response;\n          try {\n            if (success) {\n              await axios.post(`${process.env.BACKEND_IP}/payments/complete`, {\n                data: response,\n              });\n              const array = await JSON.parse(custom_data);\n              await axios.post(`${process.env.BACKEND_IP}/stock/cart`, array);\n              console.log(`stock sold id: ${id}`);\n              array.map(async (product) => {\n                await axios.post(`${process.env.BACKEND_IP}/stock/sold`, {\n                  id,\n                  ProductId: product.id,\n                  ShopId: product.ShopId,\n                  quantity: product.quantity,\n                });\n              });\n              dispatch({ type: CLEAR_CART_REQUEST });\n              if (type == \"cart\") {\n                router.push(\n                  TableId === undefined ? `/menu/${ShopId}` : `/menu/${ShopId}/${TableId}`,\n                );\n              }\n            } else {\n              alert(`결제 실패: ${error_msg}`);\n            }\n          } catch (err) {\n            return console.error(err.response);\n          }\n        },\n      );\n    }\n  } else {\n    onChangeToggleModal();\n  }\n};\n"]},"metadata":{},"sourceType":"module"}