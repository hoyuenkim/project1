{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\hoyuen\\\\Documents\\\\project\\\\project1\\\\frontend\\\\components\\\\ProductCard.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { Card, Col, Space, Row, Divider, Badge, Modal } from 'antd';\nimport NumberFormat from 'react-number-format';\nimport AmountToggle from './Generalui/AmountToggle';\nimport { useDispatch } from 'react-redux';\nimport { ADD_CART_ITEM_REQUEST } from '../reducers/cart';\nimport { INITIATE_QUANTITY_REQUEST } from '../reducers/menu';\nimport { useSelector } from 'react-redux';\nimport axios from 'axios';\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../reducers/payment';\nimport { useState } from 'react';\n\nvar ProductCard = function ProductCard(_ref) {\n  _s();\n\n  var product = _ref.product,\n      bodyRef = _ref.bodyRef;\n\n  var _useState = useState(false),\n      toggleModal = _useState[0],\n      setToggleModal = _useState[1];\n\n  var onChangeToggleModal = function onChangeToggleModal() {\n    return setToggleModal(function (prev) {\n      return !prev;\n    });\n  };\n\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return state.user;\n  }),\n      isLoggedIn = _useSelector.isLoggedIn,\n      session = _useSelector.session;\n\n  var onClickAddCart = function onClickAddCart() {\n    dispatch({\n      type: ADD_CART_ITEM_REQUEST,\n      product: product\n    });\n    dispatch({\n      type: INITIATE_QUANTITY_REQUEST,\n      data: product\n    });\n  };\n\n  var onWindowScroll = function onWindowScroll(bodyRef) {\n    var body = document.body;\n    var scrollTop = body.scrollHeight;\n    bodyRef.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n  };\n\n  var onClickPayment = function onClickPayment() {\n    if (isLoggedIn) {\n      if (IMP !== null) {\n        IMP.init('imp37098043');\n        var today = Date.now();\n        IMP.request_pay({\n          pay_method: 'card',\n          name: product.title + '-' + product.quantity + '-' + product.price,\n          Merchant_uid: 'uid' + today,\n          amount: product.discount ? product.price * (1 - product.discount) * product.quantity : product.price * product.quantity,\n          UserId: session.id,\n          ProductId: product.id,\n          ShopId: product.Shop.id\n        }, callback);\n        onWindowScroll(bodyRef);\n      }\n    } else {\n      onChangeToggleModal();\n    }\n  };\n\n  var callback = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n      var success, error_msg;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              success = response.success, error_msg = response.error_msg;\n\n              if (success) {\n                axios // .post(`${hostIp}/payments/complete/${product.id}/${product.Shop.id}/${session.id}`, { data: response })\n                .post(\"http://127.0.0.1:3065/payments/complete/\".concat(product.id, \"/\").concat(product.Shop.id, \"/\").concat(session.id), {\n                  data: response\n                }).then(function (response) {\n                  dispatch({\n                    type: PAYMENT_SUCCESS\n                  }, {\n                    data: response\n                  });\n                })[\"catch\"](function (e) {\n                  console.log(e);\n                  dispatch({\n                    type: PAYMENT_FAILURE\n                  }, {\n                    error: e\n                  });\n                });\n              } else {\n                alert(\"\\uACB0\\uC81C \\uC2E4\\uD328: \".concat(error_msg));\n              }\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function callback(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(Modal, {\n    header: null,\n    visible: toggleModal,\n    onCancel: onChangeToggleModal,\n    footer: null,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, \"\\uB85C\\uADF8\\uC778\\uC744 \\uD558\\uC154\\uC57C\\uD569\\uB2C8\\uB2E4.\"), __jsx(Card, {\n    key: product.id,\n    title: __jsx(React.Fragment, null, __jsx(\"h1\", {\n      style: {\n        display: 'inline'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 13\n      }\n    }, product.title)),\n    actions: [__jsx(\"div\", {\n      onClick: onClickPayment,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 11\n      }\n    }, \"\\uC989\\uC2DC \\uAD6C\\uB9E4\"), __jsx(\"div\", {\n      onClick: onClickAddCart,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 11\n      }\n    }, \"\\uC7A5\\uBC14\\uAD6C\\uB2C8\")],\n    cover: __jsx(\"img\", {\n      style: {\n        border: \"1px solid #EFF2F5\"\n      },\n      src: product.Images[0] && \"http://127.0.0.1:3065/uploads/\".concat(product.Images[0].url),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 11\n      }\n    }),\n    hoverable: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }, __jsx(Card.Meta, {\n    description: __jsx(React.Fragment, null, __jsx(Row, {\n      gutter: [16],\n      align: 'middle',\n      justify: 'center',\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 15\n      }\n    }, __jsx(Col, {\n      md: 16,\n      xs: 16,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 17\n      }\n    }, product.discount ? __jsx(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 21\n      }\n    }, __jsx(\"h1\", {\n      style: {\n        color: '#FF5733',\n        fontWeight: 'bold',\n        display: 'inline-block'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 23\n      }\n    }, __jsx(NumberFormat, {\n      value: product.price * (1 - discount),\n      displayType: 'text',\n      thousandSeparator: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 25\n      }\n    }), \"\\uC6D0\"), '  ', __jsx(\"h3\", {\n      style: {\n        color: '#AA9C99',\n        display: 'inline-block'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 23\n      }\n    }, (1 - product.discount) * 100, \"%\")) : __jsx(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 21\n      }\n    }, __jsx(\"h5\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 23\n      }\n    }, \"\\uAC00\\uACA9\"), __jsx(\"h1\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 23\n      }\n    }, __jsx(NumberFormat, {\n      value: product.price,\n      displayType: 'text',\n      thousandSeparator: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 25\n      }\n    }), \"\\uC6D0\")), ' '), __jsx(Col, {\n      md: 8,\n      xs: 8,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 17\n      }\n    }, __jsx(AmountToggle, {\n      id: product.id,\n      quantity: product.quantity,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 19\n      }\n    }))), __jsx(Divider, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 15\n      }\n    }), __jsx(Row, {\n      align: 'middle',\n      justify: 'center',\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 15\n      }\n    }, __jsx(Col, {\n      span: 8,\n      xs: 8,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 17\n      }\n    }, __jsx(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 19\n      }\n    }, \"\\uCD1D \\uC8FC\\uBB38\\uAE08\\uC561\")), __jsx(Col, {\n      span: 16,\n      xs: 16,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 17\n      }\n    }, __jsx(\"div\", {\n      style: {\n        textAlign: 'right'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 19\n      }\n    }, __jsx(\"h1\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 21\n      }\n    }, __jsx(NumberFormat, {\n      value: product.discount ? product.price * (1 - product.discount) * product.quantity : product.price * product.quantity,\n      displayType: 'text',\n      thousandSeparator: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 23\n      }\n    }), \"\\uC6D0\"))))),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  })));\n};\n\n_s(ProductCard, \"SRnYD1hfmV55UkNqH2oEKG5V4UQ=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = ProductCard;\nexport default ProductCard;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProductCard\");","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/project/project1/frontend/components/ProductCard.js"],"names":["Card","Col","Space","Row","Divider","Badge","Modal","NumberFormat","AmountToggle","useDispatch","ADD_CART_ITEM_REQUEST","INITIATE_QUANTITY_REQUEST","useSelector","axios","PAYMENT_FAILURE","PAYMENT_SUCCESS","useState","ProductCard","product","bodyRef","toggleModal","setToggleModal","onChangeToggleModal","prev","dispatch","state","user","isLoggedIn","session","onClickAddCart","type","data","onWindowScroll","body","document","scrollTop","scrollHeight","scrollTo","top","behavior","onClickPayment","IMP","init","today","Date","now","request_pay","pay_method","name","title","quantity","price","Merchant_uid","amount","discount","UserId","id","ProductId","ShopId","Shop","callback","response","success","error_msg","post","then","e","console","log","error","alert","display","border","Images","url","color","fontWeight","textAlign"],"mappings":"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","sourcesContent":["import { Card, Col, Space, Row, Divider, Badge, Modal } from 'antd';\r\nimport NumberFormat from 'react-number-format';\r\nimport AmountToggle from './Generalui/AmountToggle';\r\nimport { useDispatch } from 'react-redux';\r\nimport { ADD_CART_ITEM_REQUEST } from '../reducers/cart';\r\nimport { INITIATE_QUANTITY_REQUEST } from '../reducers/menu';\r\nimport { useSelector } from 'react-redux';\r\nimport axios from 'axios';\r\nimport { PAYMENT_FAILURE, PAYMENT_SUCCESS } from '../reducers/payment';\r\nimport { useState } from 'react';\r\n\r\nconst ProductCard = ({ product, bodyRef }) => {\r\n  const [toggleModal, setToggleModal] = useState(false);\r\n  const onChangeToggleModal = () => setToggleModal((prev) => !prev);\r\n  const dispatch = useDispatch();\r\n\r\n  const { isLoggedIn, session } = useSelector((state) => state.user);\r\n\r\n  const onClickAddCart = () => {\r\n    dispatch({\r\n      type: ADD_CART_ITEM_REQUEST,\r\n      product,\r\n    });\r\n    dispatch({ type: INITIATE_QUANTITY_REQUEST, data: product });\r\n  };\r\n\r\n  const onWindowScroll = (bodyRef) => {\r\n    const body = document.body;\r\n    const scrollTop = body.scrollHeight;\r\n    bodyRef.scrollTo({ top: 0, behavior: 'smooth' });\r\n  };\r\n\r\n  const onClickPayment = () => {\r\n    if (isLoggedIn) {\r\n      if (IMP !== null) {\r\n        IMP.init('imp37098043');\r\n        const today = Date.now();\r\n        IMP.request_pay(\r\n          {\r\n            pay_method: 'card',\r\n            name: product.title + '-' + product.quantity + '-' + product.price,\r\n            Merchant_uid: 'uid' + today,\r\n            amount: product.discount\r\n              ? product.price * (1 - product.discount) * product.quantity\r\n              : product.price * product.quantity,\r\n            UserId: session.id,\r\n            ProductId: product.id,\r\n            ShopId: product.Shop.id,\r\n          },\r\n          callback,\r\n        );\r\n        onWindowScroll(bodyRef);\r\n      }\r\n    } else {\r\n      onChangeToggleModal();\r\n    }\r\n  };\r\n\r\n  const callback = async (response) => {\r\n    const { success, error_msg } = response;\r\n    if (success) {\r\n      axios\r\n        // .post(`${hostIp}/payments/complete/${product.id}/${product.Shop.id}/${session.id}`, { data: response })\r\n        .post(\r\n          `http://127.0.0.1:3065/payments/complete/${product.id}/${product.Shop.id}/${session.id}`,\r\n          { data: response },\r\n        )\r\n        .then((response) => {\r\n          dispatch({ type: PAYMENT_SUCCESS }, { data: response });\r\n        })\r\n        .catch((e) => {\r\n          console.log(e);\r\n          dispatch({ type: PAYMENT_FAILURE }, { error: e });\r\n        });\r\n    } else {\r\n      alert(`결제 실패: ${error_msg}`);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Modal header={null} visible={toggleModal} onCancel={onChangeToggleModal} footer={null}>\r\n        로그인을 하셔야합니다.\r\n      </Modal>\r\n      <Card\r\n        key={product.id}\r\n        title={\r\n          <>\r\n            <h1 style={{ display: 'inline' }}>{product.title}</h1>\r\n          </>\r\n        }\r\n        actions={[\r\n          <div onClick={onClickPayment}>즉시 구매</div>,\r\n          <div onClick={onClickAddCart}>장바구니</div>,\r\n        ]}\r\n        cover={\r\n          <img\r\n            style={{ border: `1px solid #EFF2F5` }}\r\n            src={product.Images[0] && `http://127.0.0.1:3065/uploads/${product.Images[0].url}`}\r\n          />\r\n        }\r\n        hoverable\r\n      >\r\n        <Card.Meta\r\n          description={\r\n            <>\r\n              <Row gutter={[16]} align={'middle'} justify={'center'}>\r\n                <Col md={16} xs={16}>\r\n                  {product.discount ? (\r\n                    <div>\r\n                      <h1 style={{ color: '#FF5733', fontWeight: 'bold', display: 'inline-block' }}>\r\n                        <NumberFormat\r\n                          value={product.price * (1 - discount)}\r\n                          displayType={'text'}\r\n                          thousandSeparator={true}\r\n                        />\r\n                        원\r\n                      </h1>\r\n                      {'  '}\r\n                      <h3 style={{ color: '#AA9C99', display: 'inline-block' }}>\r\n                        {(1 - product.discount) * 100}%\r\n                      </h3>\r\n                    </div>\r\n                  ) : (\r\n                    <div>\r\n                      <h5>가격</h5>\r\n                      <h1>\r\n                        <NumberFormat\r\n                          value={product.price}\r\n                          displayType={'text'}\r\n                          thousandSeparator={true}\r\n                        />\r\n                        원\r\n                      </h1>\r\n                    </div>\r\n                  )}{' '}\r\n                </Col>\r\n                <Col md={8} xs={8}>\r\n                  <AmountToggle id={product.id} quantity={product.quantity} />\r\n                </Col>\r\n              </Row>\r\n              <Divider />\r\n              <Row align={'middle'} justify={'center'}>\r\n                <Col span={8} xs={8}>\r\n                  <div>총 주문금액</div>\r\n                </Col>\r\n                <Col span={16} xs={16}>\r\n                  <div style={{ textAlign: 'right' }}>\r\n                    <h1>\r\n                      <NumberFormat\r\n                        value={\r\n                          product.discount\r\n                            ? product.price * (1 - product.discount) * product.quantity\r\n                            : product.price * product.quantity\r\n                        }\r\n                        displayType={'text'}\r\n                        thousandSeparator={true}\r\n                      />\r\n                      원\r\n                    </h1>\r\n                  </div>\r\n                </Col>\r\n              </Row>\r\n            </>\r\n          }\r\n        />\r\n      </Card>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ProductCard;\r\n"]},"metadata":{},"sourceType":"module"}