{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\hoyuen\\\\Documents\\\\dev\\\\project1\\\\frontend\\\\pages\\\\payments\\\\index.js\";\nimport { List, Tag, Avatar, Card, Empty, Rate, DatePicker, Modal, Input, Button, Form, Space, Select, Row, Col } from 'antd';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useInput } from '../../components/Generalui/CustomHooks';\nimport NumberFormat from 'react-number-format';\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport { PAYMENT_HISTORY_REMOVE_REQUEST, LOAD_PAYMENT_HISTORY_REQUEST, RATING_REQUEST, SEARCH_HISTORY_REQUEST } from '../../reducers/payment';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst {\n  RangePicker\n} = DatePicker;\n\nconst History = () => {\n  const dispatch = useDispatch();\n  const router = useRouter();\n  const {\n    0: startDate,\n    1: setStartDate\n  } = useState();\n  const {\n    0: endDate,\n    1: setEndDate\n  } = useState();\n  const [text, onChangeText, setText] = useInput();\n  const {\n    0: select,\n    1: setSelect\n  } = useState('product');\n  const {\n    0: toggleSearch,\n    1: setToggleSearch\n  } = useState(false);\n  const {\n    0: searchError,\n    1: setSearchError\n  } = useState(false);\n  const {\n    isLoggedIn,\n    session\n  } = useSelector(state => state.user);\n  const {\n    history\n  } = useSelector(state => state.payment);\n\n  if (!isLoggedIn || !session) {\n    router.back();\n  }\n\n  useEffect(() => {\n    dispatch({\n      type: LOAD_PAYMENT_HISTORY_REQUEST,\n      division: session.division,\n      id: session.id\n    });\n  }, []);\n\n  const onChangeDatePicker = e => {\n    if (e === null) {\n      setStartDate(null);\n      setEndDate(null);\n    } else {\n      const start = new Date(e[0]._d);\n      const end = new Date(e[1]._d);\n      setStartDate(start);\n      setEndDate(end);\n    }\n  };\n\n  const onToggleSearch = () => {\n    if (searchError) {\n      setSearchError(false);\n    }\n\n    setToggleSearch(prev => !prev);\n  };\n\n  const dateFormat = 'YYYY/MM/DD';\n\n  const onChangeSelect = e => {\n    setSelect(e);\n  };\n\n  const onFinishSearch = () => {\n    dispatch({\n      type: SEARCH_HISTORY_REQUEST,\n      data: {\n        startDate,\n        endDate,\n        text,\n        select,\n        division: session.division,\n        UserId: session.id\n      }\n    });\n    setStartDate(null);\n    setEndDate(null);\n    setText(null);\n    return setToggleSearch(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Modal, {\n      title: 'Search',\n      visible: toggleSearch,\n      onCancel: onToggleSearch,\n      footer: null,\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        onFinish: onFinishSearch,\n        children: /*#__PURE__*/_jsxDEV(Space, {\n          direction: 'vertical',\n          style: {\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Row, {\n            gutter: [10, 10],\n            children: [/*#__PURE__*/_jsxDEV(Col, {\n              span: 6,\n              children: /*#__PURE__*/_jsxDEV(Select, {\n                defaultValue: 'title',\n                onChange: onChangeSelect,\n                style: {\n                  width: '100%'\n                },\n                children: [/*#__PURE__*/_jsxDEV(Select.Option, {\n                  value: 'title',\n                  children: \"\\uBA54\\uB274\\uBA85\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 108,\n                  columnNumber: 19\n                }, this), session && session.division == true ? /*#__PURE__*/_jsxDEV(Select.Option, {\n                  value: 'user',\n                  children: \"\\uACE0\\uAC1D\\uBA85\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 110,\n                  columnNumber: 21\n                }, this) : /*#__PURE__*/_jsxDEV(Select.Option, {\n                  value: 'shop',\n                  children: \"\\uB9E4\\uC7A5\\uBA85\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 112,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 107,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 106,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              span: 18,\n              children: /*#__PURE__*/_jsxDEV(Input, {\n                onChange: onChangeText,\n                value: text,\n                style: {\n                  width: '100%'\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 117,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              span: 24,\n              children: /*#__PURE__*/_jsxDEV(RangePicker, {\n                style: {\n                  verticalAlign: 'middle',\n                  width: '100%'\n                },\n                format: dateFormat,\n                onChange: onChangeDatePicker,\n                defaultValue: [startDate, endDate],\n                inputReadOnly: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 120,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            type: 'primary',\n            style: {\n              width: '100%'\n            },\n            htmlType: 'submit',\n            children: \"\\uAC80\\uC0C9\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), history.length === 0 ? /*#__PURE__*/_jsxDEV(Card, {\n      style: {\n        height: '100vh'\n      },\n      extra: /*#__PURE__*/_jsxDEV(Button, {\n        onClick: onToggleSearch,\n        children: \"\\uAC80\\uC0C9\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 50\n      }, this),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Empty, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"\\uAC70\\uB798\\uB0B4\\uC5ED\\uC774 \\uC874\\uC7AC\\uD558\\uC9C0 \\uC54A\\uC2B5\\uB2C8\\uB2E4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(Card, {\n      extra: /*#__PURE__*/_jsxDEV(Button, {\n        onClick: onToggleSearch,\n        type: 'primary',\n        children: \"\\uAC80\\uC0C9\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 13\n      }, this),\n      children: /*#__PURE__*/_jsxDEV(List, {\n        itemLayout: \"horizontal\",\n        dataSource: history,\n        renderItem: item => {\n          const date = new Date(item.createdAt);\n          const localeDate = date.toLocaleString();\n\n          const onChangeRating = value => {\n            dispatch({\n              type: RATING_REQUEST,\n              data: {\n                PaymentsId: item.id,\n                UserId: session.id,\n                rate: value,\n                ProductId: item.Product.id\n              }\n            });\n          };\n\n          const onClickRemoveHistory = () => {\n            dispatch({\n              type: PAYMENT_HISTORY_REMOVE_REQUEST,\n              data: {\n                id: item.id,\n                imp_uid: item.imp_uid,\n                UserId: session.id,\n                division: session.division,\n                amount: item.amount\n              }\n            });\n          };\n\n          return /*#__PURE__*/_jsxDEV(List.Item, {\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              style: {\n                width: '100%'\n              },\n              extra: session && session.division == 0 ? item.status == 0 ? /*#__PURE__*/_jsxDEV(Button, {\n                onClick: onClickRemoveHistory,\n                type: 'primary',\n                children: \"\\uACB0\\uC81C\\uCDE8\\uC18C\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 190,\n                columnNumber: 27\n              }, this) : item.status == 1 ? /*#__PURE__*/_jsxDEV(Button, {\n                readOnly: true,\n                danger: true,\n                children: \"\\uACB0\\uC81C\\uCDE8\\uC18C \\uC9C4\\uD589 \\uC911\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 27\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                disabled: true,\n                children: \"\\uACB0\\uC81C\\uCDE8\\uC18C \\uC644\\uB8CC\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 198,\n                columnNumber: 27\n              }, this) : item.status == 0 ? /*#__PURE__*/_jsxDEV(Button, {\n                onClick: onClickRemoveHistory,\n                type: 'primary',\n                children: \"\\uACB0\\uC81C\\uCDE8\\uC18C\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 201,\n                columnNumber: 25\n              }, this) : item.status == 1 ? /*#__PURE__*/_jsxDEV(Button, {\n                danger: true,\n                onClick: onClickRemoveHistory,\n                children: \"\\uACB0\\uC81C\\uCDE8\\uC18C \\uC694\\uCCAD\\uC811\\uC218\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 205,\n                columnNumber: 25\n              }, this) : /*#__PURE__*/_jsxDEV(Button, {\n                disabled: true,\n                children: \"\\uACB0\\uC81C\\uCDE8\\uC18C \\uC644\\uB8CC\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 209,\n                columnNumber: 25\n              }, this),\n              children: /*#__PURE__*/_jsxDEV(List.Item.Meta, {\n                title: /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [item.Shop.name, \"_\", item.Product.title, \"_\", localeDate]\n                }, void 0, true),\n                description: /*#__PURE__*/_jsxDEV(_Fragment, {\n                  children: [session && session.division == true && item.User && /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: item.User.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 222,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\"\\uACB0\\uC81C\\uC218\\uB7C9:\", ' ', /*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: item.quantity,\n                      displayType: 'text',\n                      thousandSeparator: true\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 226,\n                      columnNumber: 29\n                    }, this), \"\\uAC1C, \\uACB0\\uC81C\\uB2E8\\uAC00:\", ' ', /*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: item.price / item.quantity,\n                      displayType: 'text',\n                      thousandSeparator: true\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 232,\n                      columnNumber: 29\n                    }, this), \"\\uC6D0\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 224,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n                    children: [\"\\uACB0\\uC81C\\uAE08\\uC561:\", ' ', /*#__PURE__*/_jsxDEV(NumberFormat, {\n                      value: item.price,\n                      displayType: 'text',\n                      thousandSeparator: true\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 241,\n                      columnNumber: 29\n                    }, this), \"\\uC6D0\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 239,\n                    columnNumber: 27\n                  }, this), session && session.division == true ? /*#__PURE__*/_jsxDEV(Rate, {\n                    disabled: true,\n                    defaultValue: item.Rating && item.Rating.rate ? item.Rating.rate : null\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 249,\n                    columnNumber: 29\n                  }, this) : /*#__PURE__*/_jsxDEV(Rate, {\n                    defaultValue: item.Rating && item.Rating.rate ? item.Rating.rate : null,\n                    onChange: onChangeRating\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 256,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true),\n                avatar: /*#__PURE__*/_jsxDEV(Avatar, {\n                  size: 50,\n                  shape: \"square\",\n                  src: `http://127.0.0.1:3065/uploads/${item.Product.Images[0].url}`\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 266,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 17\n          }, this);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n\nexport default History;","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/dev/project1/frontend/pages/payments/index.js"],"names":["List","Tag","Avatar","Card","Empty","Rate","DatePicker","Modal","Input","Button","Form","Space","Select","Row","Col","useDispatch","useSelector","useInput","NumberFormat","useEffect","useState","useRouter","PAYMENT_HISTORY_REMOVE_REQUEST","LOAD_PAYMENT_HISTORY_REQUEST","RATING_REQUEST","SEARCH_HISTORY_REQUEST","RangePicker","History","dispatch","router","startDate","setStartDate","endDate","setEndDate","text","onChangeText","setText","select","setSelect","toggleSearch","setToggleSearch","searchError","setSearchError","isLoggedIn","session","state","user","history","payment","back","type","division","id","onChangeDatePicker","e","start","Date","_d","end","onToggleSearch","prev","dateFormat","onChangeSelect","onFinishSearch","data","UserId","width","verticalAlign","length","height","textAlign","item","date","createdAt","localeDate","toLocaleString","onChangeRating","value","PaymentsId","rate","ProductId","Product","onClickRemoveHistory","imp_uid","amount","status","Shop","name","title","User","quantity","price","Rating","Images","url"],"mappings":"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","sourcesContent":["import {\r\n  List,\r\n  Tag,\r\n  Avatar,\r\n  Card,\r\n  Empty,\r\n  Rate,\r\n  DatePicker,\r\n  Modal,\r\n  Input,\r\n  Button,\r\n  Form,\r\n  Space,\r\n  Select,\r\n  Row,\r\n  Col,\r\n} from 'antd';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { useInput } from '../../components/Generalui/CustomHooks';\r\n\r\nimport NumberFormat from 'react-number-format';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport {\r\n  PAYMENT_HISTORY_REMOVE_REQUEST,\r\n  LOAD_PAYMENT_HISTORY_REQUEST,\r\n  RATING_REQUEST,\r\n  SEARCH_HISTORY_REQUEST,\r\n} from '../../reducers/payment';\r\n\r\nconst { RangePicker } = DatePicker;\r\n\r\nconst History = () => {\r\n  const dispatch = useDispatch();\r\n  const router = useRouter();\r\n\r\n  const [startDate, setStartDate] = useState();\r\n  const [endDate, setEndDate] = useState();\r\n  const [text, onChangeText, setText] = useInput();\r\n  const [select, setSelect] = useState('product');\r\n\r\n  const [toggleSearch, setToggleSearch] = useState(false);\r\n\r\n  const [searchError, setSearchError] = useState(false);\r\n\r\n  const { isLoggedIn, session } = useSelector((state) => state.user);\r\n  const { history } = useSelector((state) => state.payment);\r\n  if (!isLoggedIn || !session) {\r\n    router.back();\r\n  }\r\n\r\n  useEffect(() => {\r\n    dispatch({ type: LOAD_PAYMENT_HISTORY_REQUEST, division: session.division, id: session.id });\r\n  }, []);\r\n\r\n  const onChangeDatePicker = (e) => {\r\n    if (e === null) {\r\n      setStartDate(null);\r\n      setEndDate(null);\r\n    } else {\r\n      const start = new Date(e[0]._d);\r\n      const end = new Date(e[1]._d);\r\n      setStartDate(start);\r\n      setEndDate(end);\r\n    }\r\n  };\r\n\r\n  const onToggleSearch = () => {\r\n    if (searchError) {\r\n      setSearchError(false);\r\n    }\r\n    setToggleSearch((prev) => !prev);\r\n  };\r\n\r\n  const dateFormat = 'YYYY/MM/DD';\r\n\r\n  const onChangeSelect = (e) => {\r\n    setSelect(e);\r\n  };\r\n\r\n  const onFinishSearch = () => {\r\n    dispatch({\r\n      type: SEARCH_HISTORY_REQUEST,\r\n      data: {\r\n        startDate,\r\n        endDate,\r\n        text,\r\n        select,\r\n        division: session.division,\r\n        UserId: session.id,\r\n      },\r\n    });\r\n    setStartDate(null);\r\n    setEndDate(null);\r\n    setText(null);\r\n    return setToggleSearch(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Modal title={'Search'} visible={toggleSearch} onCancel={onToggleSearch} footer={null}>\r\n        <Form onFinish={onFinishSearch}>\r\n          <Space direction={'vertical'} style={{ width: '100%' }}>\r\n            <Row gutter={[10, 10]}>\r\n              <Col span={6}>\r\n                <Select defaultValue={'title'} onChange={onChangeSelect} style={{ width: '100%' }}>\r\n                  <Select.Option value={'title'}>메뉴명</Select.Option>\r\n                  {session && session.division == true ? (\r\n                    <Select.Option value={'user'}>고객명</Select.Option>\r\n                  ) : (\r\n                    <Select.Option value={'shop'}>매장명</Select.Option>\r\n                  )}\r\n                </Select>\r\n              </Col>\r\n              <Col span={18}>\r\n                <Input onChange={onChangeText} value={text} style={{ width: '100%' }} />\r\n              </Col>\r\n              <Col span={24}>\r\n                <RangePicker\r\n                  style={{ verticalAlign: 'middle', width: '100%' }}\r\n                  format={dateFormat}\r\n                  onChange={onChangeDatePicker}\r\n                  defaultValue={[startDate, endDate]}\r\n                  inputReadOnly\r\n                />\r\n              </Col>\r\n            </Row>\r\n            <Button type={'primary'} style={{ width: '100%' }} htmlType={'submit'}>\r\n              검색\r\n            </Button>\r\n          </Space>\r\n        </Form>\r\n      </Modal>\r\n\r\n      {history.length === 0 ? (\r\n        <Card style={{ height: '100vh' }} extra={<Button onClick={onToggleSearch}>검색</Button>}>\r\n          <div style={{ textAlign: 'center' }}>\r\n            <Empty />\r\n            <h1>거래내역이 존재하지 않습니다</h1>\r\n          </div>\r\n        </Card>\r\n      ) : (\r\n        <Card\r\n          extra={\r\n            <Button onClick={onToggleSearch} type={'primary'}>\r\n              검색\r\n            </Button>\r\n          }\r\n        >\r\n          <List\r\n            itemLayout=\"horizontal\"\r\n            dataSource={history}\r\n            renderItem={(item) => {\r\n              const date = new Date(item.createdAt);\r\n              const localeDate = date.toLocaleString();\r\n\r\n              const onChangeRating = (value) => {\r\n                dispatch({\r\n                  type: RATING_REQUEST,\r\n                  data: {\r\n                    PaymentsId: item.id,\r\n                    UserId: session.id,\r\n                    rate: value,\r\n                    ProductId: item.Product.id,\r\n                  },\r\n                });\r\n              };\r\n\r\n              const onClickRemoveHistory = () => {\r\n                dispatch({\r\n                  type: PAYMENT_HISTORY_REMOVE_REQUEST,\r\n                  data: {\r\n                    id: item.id,\r\n                    imp_uid: item.imp_uid,\r\n                    UserId: session.id,\r\n                    division: session.division,\r\n                    amount: item.amount,\r\n                  },\r\n                });\r\n              };\r\n\r\n              return (\r\n                <List.Item>\r\n                  <Card\r\n                    style={{ width: '100%' }}\r\n                    extra={\r\n                      session && session.division == 0 ? (\r\n                        item.status == 0 ? (\r\n                          <Button onClick={onClickRemoveHistory} type={'primary'}>\r\n                            결제취소\r\n                          </Button>\r\n                        ) : item.status == 1 ? (\r\n                          <Button readOnly danger>\r\n                            결제취소 진행 중\r\n                          </Button>\r\n                        ) : (\r\n                          <Button disabled>결제취소 완료</Button>\r\n                        )\r\n                      ) : item.status == 0 ? (\r\n                        <Button onClick={onClickRemoveHistory} type={'primary'}>\r\n                          결제취소\r\n                        </Button>\r\n                      ) : item.status == 1 ? (\r\n                        <Button danger onClick={onClickRemoveHistory}>\r\n                          결제취소 요청접수\r\n                        </Button>\r\n                      ) : (\r\n                        <Button disabled>결제취소 완료</Button>\r\n                      )\r\n                    }\r\n                  >\r\n                    <List.Item.Meta\r\n                      title={\r\n                        <>\r\n                          {item.Shop.name}_{item.Product.title}_{localeDate}\r\n                        </>\r\n                      }\r\n                      description={\r\n                        <>\r\n                          {session && session.division == true && item.User && (\r\n                            <p>{item.User.name}</p>\r\n                          )}\r\n                          <p>\r\n                            결제수량:{' '}\r\n                            <NumberFormat\r\n                              value={item.quantity}\r\n                              displayType={'text'}\r\n                              thousandSeparator={true}\r\n                            />\r\n                            개, 결제단가:{' '}\r\n                            <NumberFormat\r\n                              value={item.price / item.quantity}\r\n                              displayType={'text'}\r\n                              thousandSeparator={true}\r\n                            />\r\n                            원\r\n                          </p>\r\n                          <h3>\r\n                            결제금액:{' '}\r\n                            <NumberFormat\r\n                              value={item.price}\r\n                              displayType={'text'}\r\n                              thousandSeparator={true}\r\n                            />\r\n                            원\r\n                          </h3>\r\n                          {session && session.division == true ? (\r\n                            <Rate\r\n                              disabled\r\n                              defaultValue={\r\n                                item.Rating && item.Rating.rate ? item.Rating.rate : null\r\n                              }\r\n                            />\r\n                          ) : (\r\n                            <Rate\r\n                              defaultValue={\r\n                                item.Rating && item.Rating.rate ? item.Rating.rate : null\r\n                              }\r\n                              onChange={onChangeRating}\r\n                            />\r\n                          )}\r\n                        </>\r\n                      }\r\n                      avatar={\r\n                        <Avatar\r\n                          size={50}\r\n                          shape=\"square\"\r\n                          src={`http://127.0.0.1:3065/uploads/${item.Product.Images[0].url}`}\r\n                        />\r\n                      }\r\n                    />\r\n                  </Card>\r\n                </List.Item>\r\n              );\r\n            }}\r\n          />\r\n        </Card>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default History;\r\n"]},"metadata":{},"sourceType":"module"}