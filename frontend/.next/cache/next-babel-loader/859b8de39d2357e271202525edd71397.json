{"ast":null,"code":"import axios from 'axios';\nimport { CLEAR_CART_REQUEST } from '../../reducers/cart';\nexport const onClickPayment = (type, product, isLoggedIn, session, dispatch, cart, router, ShopId, TableId) => {\n  const onWindowScroll = () => {\n    window.scrollTo({\n      top: 0\n    });\n  };\n\n  let originData;\n  let amount = 0;\n  let name;\n\n  if (isLoggedIn) {\n    if (type == 'single') {\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.discount ? product.price * (100 - product.discount) * 0.01 * product.quantity : product.price * product.quantity,\n        quantity: product.quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title\n      };\n    } else {\n      cart.map(product => amount += product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity);\n      name = cart.length > 1 ? `${product.title} 외 ${cart.length - 1} 건` : product.title;\n      originData = cart.map(product => {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(type == 'single' ? [originData] : originData);\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay({\n        pay_method: 'card',\n        name: type !== 'cart' ? product.title : name,\n        Merchant_uid: 'uid' + today,\n        amount: type !== 'cart' ? product.Discount ? product.price * (100 - product.Discount.rate) * 0.01 * product.quantity : product.price * product.quantity : amount,\n        custom_data\n      }, response => {\n        const {\n          success,\n          merchant_uid,\n          error_msg\n        } = response;\n\n        if (success) {\n          axios.post(`${process.env.BACKEND_IP}/payments/complete`, {\n            data: response\n          }).then(res => {\n            console.log(`type: ${type}, ShopId: ${ShopId}, TableId: ${TableId}`);\n            dispatch({\n              type: CLEAR_CART_REQUEST\n            });\n\n            if (type == 'cart') {\n              router.push(TableId === undefined ? `/menu/${ShopId}` : `/menu/${ShopId}/${TableId}`);\n            }\n          }).catch(err => {\n            return console.error(err);\n          });\n        } else {\n          alert(`결제 실패: ${error_msg}`);\n        }\n      });\n    }\n  } else {\n    alert('error');\n  }\n};","map":{"version":3,"sources":["C:/Users/hoyuen/Documents/dev/project1/frontend/components/Generalui/Payment.js"],"names":["axios","CLEAR_CART_REQUEST","onClickPayment","type","product","isLoggedIn","session","dispatch","cart","router","ShopId","TableId","onWindowScroll","window","scrollTo","top","originData","amount","name","UserId","id","UserName","ProductId","Shop","price","discount","quantity","ShopName","ProductTitle","title","map","Discount","rate","length","custom_data","JSON","stringify","IMP","init","process","env","IAMPORT_KEY","today","Date","now","request_pay","pay_method","Merchant_uid","response","success","merchant_uid","error_msg","post","BACKEND_IP","data","then","res","console","log","push","undefined","catch","err","error","alert"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { CLEAR_CART_REQUEST } from '../../reducers/cart';\n\nexport const onClickPayment = (\n  type,\n  product,\n  isLoggedIn,\n  session,\n  dispatch,\n  cart,\n  router,\n  ShopId,\n  TableId\n) => {\n  const onWindowScroll = () => {\n    window.scrollTo({ top: 0 });\n  };\n\n  let originData;\n  let amount = 0;\n  let name;\n  if (isLoggedIn) {\n    if (type == 'single') {\n      originData = {\n        UserId: session.id,\n        UserName: session.name,\n        ProductId: product.id,\n        ShopId: product.Shop.id,\n        price: product.discount\n          ? product.price * (100 - product.discount) * 0.01 * product.quantity\n          : product.price * product.quantity,\n        quantity: product.quantity,\n        ShopName: product.Shop.name,\n        ProductTitle: product.title,\n      };\n    } else {\n      cart.map(\n        (product) =>\n          (amount += product.Discount\n            ? product.price *\n              (100 - product.Discount.rate) *\n              0.01 *\n              product.quantity\n            : product.price * product.quantity)\n      );\n      name =\n        cart.length > 1\n          ? `${product.title} 외 ${cart.length - 1} 건`\n          : product.title;\n      originData = cart.map((product) => {\n        return {\n          ProductId: product.id,\n          ShopId: product.Shop.id,\n          UserId: session.id,\n          UserName: session.name,\n          price: product.Discount\n            ? product.price * (100 - product.Discount.rate) * 0.01\n            : product.price,\n          quantity: product.quantity,\n          ShopName: product.Shop.name,\n          ProductTitle: product.title,\n        };\n      });\n    }\n\n    const custom_data = JSON.stringify(\n      type == 'single' ? [originData] : originData\n    );\n\n    if (IMP !== null) {\n      onWindowScroll();\n      IMP.init(process.env.IAMPORT_KEY);\n      const today = Date.now();\n      IMP.request_pay(\n        {\n          pay_method: 'card',\n          name: type !== 'cart' ? product.title : name,\n          Merchant_uid: 'uid' + today,\n          amount:\n            type !== 'cart'\n              ? product.Discount\n                ? product.price *\n                  (100 - product.Discount.rate) *\n                  0.01 *\n                  product.quantity\n                : product.price * product.quantity\n              : amount,\n          custom_data,\n        },\n        (response) => {\n          const { success, merchant_uid, error_msg } = response;\n          if (success) {\n            axios\n              .post(`${process.env.BACKEND_IP}/payments/complete`, {\n                data: response,\n              })\n              .then((res) => {\n                console.log(\n                  `type: ${type}, ShopId: ${ShopId}, TableId: ${TableId}`\n                );\n                dispatch({ type: CLEAR_CART_REQUEST });\n                if (type == 'cart') {\n                  router.push(\n                    TableId === undefined\n                      ? `/menu/${ShopId}`\n                      : `/menu/${ShopId}/${TableId}`\n                  );\n                }\n              })\n              .catch((err) => {\n                return console.error(err);\n              });\n          } else {\n            alert(`결제 실패: ${error_msg}`);\n          }\n        }\n      );\n    }\n  } else {\n    alert('error');\n  }\n};\n"]},"metadata":{},"sourceType":"module"}